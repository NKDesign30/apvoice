{"remainingRequest":"/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/src/components/form-renderer/PharmaciesFuzzySearch.vue?vue&type=style&index=0&id=90aab844&lang=scss&scoped=true&","dependencies":[{"path":"/app/src/components/form-renderer/PharmaciesFuzzySearch.vue","mtime":1683275992559},{"path":"/app/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/app/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5mdXp6eS1zZWFyY2gtcmVzdWx0cyB7CiAgbWF4LWhlaWdodDogMThyZW07Cn0K"},{"version":3,"sources":["PharmaciesFuzzySearch.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiJA;AACA;AACA","file":"PharmaciesFuzzySearch.vue","sourceRoot":"src/components/form-renderer","sourcesContent":["<template>\n  <div v-on-clickaway=\"onClickAway\" class=\"relative w-11/12 mx-auto tablet:w-full\">\n    <apo-input-label\n      for=\"pharmacy-fuzzy-serach\"\n      class=\"mb-4\"\n      v-text=\"$t('general.pharmacySearch')\"\n    />\n    <apo-text-input\n      id=\"pharmacy-fuzzy-serach\"\n      v-model=\"term\"\n      :placeholder=\"$t('general.fuzzySearch.placeholder')\"\n      @input=\"search\"\n    >\n      <template #after>\n        <div class=\"absolute right-0 mr-8\">\n          <apo-spinner v-if=\"isBusy\" size=\"small\" />\n        </div>\n      </template>\n    </apo-text-input>\n    <ul\n      v-if=\"pharmacies.length > 0 || noResults\"\n      class=\"absolute z-50 w-full mt-1 overflow-auto bg-white border-2 shadow-2xl fuzzy-search-results\"\n    >\n      <li v-if=\"noResults\" class=\"px-4 py-3 border-b-2 tablet:px-3\" tabindex=\"0\">\n        {{ $t(\"general.noResults\") }}\n      </li>\n      <li\n        v-for=\"(pharmacy, index) in pharmacies\"\n        :key=\"`pharmacy-result-${index}`\"\n        class=\"px-4 py-3 border-b-2 cursor-pointer tablet:px-3 hover:bg-blue-100\"\n        tabindex=\"0\"\n        @click=\"select(pharmacy)\"\n        @keydown.enter=\"select(pharmacy)\"\n      >\n        {{ pharmacy }}\n      </li>\n    </ul>\n    <slot />\n  </div>\n</template>\n\n<script>\nimport { mixin as clickaway } from \"vue-clickaway\";\nimport InputLabel from \"@/components/form-renderer/InputLabel.vue\";\nimport TextInput from \"@/components/form-renderer/TextInput.vue\";\nimport FuzzySearchService from \"@/services/api/FuzzySearchService\";\nimport { mapState, mapGetters } from \"vuex\";\nimport UserService from \"@/services/api/UserService\";\nexport default {\n  name: \"PharmaciesFuzzySearch\",\n\n  components: {\n    \"apo-input-label\": InputLabel,\n    \"apo-text-input\": TextInput\n  },\n\n  mixins: [clickaway],\n\n  data() {\n    return {\n      isBusy: false,\n      term: null,\n      debounceTimer: null,\n      pharmacies: [],\n      noResults: false\n    };\n  },\n  computed: {\n    ...mapGetters([\"language\"])\n  },\n  methods: {\n    language() {\n      return this.language;\n    },\n\n    search() {\n      this.noResults = false;\n\n      clearTimeout(this.debounceTimer);\n      this.debounceTimer = setTimeout(() => {\n        if (this.search) {\n          if (window.fuzzySearchCancelToken) {\n            window.fuzzySearchCancelToken.cancel();\n          }\n          // set busy state in next tick to handle canceld requests\n          setTimeout(() => {\n            this.isBusy = true;\n          }, 0);\n          FuzzySearchService.fetch(decodeURIComponent(this.term))\n            .then(({ results }) => {\n              this.noResults = results.length === 0;\n              this.pharmacies = results;\n            })\n            .catch(console.error)\n            .finally(() => {\n              this.isBusy = false;\n            });\n        }\n      }, 150);\n    },\n\n    select(pharmacy) {\n      this.reset();\n      this.term = pharmacy;\n      console.log(this.extractFromString(pharmacy));\n      this.$emit(\"selected\", this.extractFromString(pharmacy));\n    },\n\n    extractFromString(pharmacy) {\n      let result = null;\n      try {\n        const [name, streetWithNumber, zip, city] = pharmacy.split(\",\").map(row => row.trim());\n        const match = streetWithNumber.match(/\\d/);\n        const street = streetWithNumber.substr(0, match.index).trim();\n        const number = streetWithNumber.substr(match.index).trim();\n\n        result = {\n          name,\n          street,\n          number,\n          zip,\n          city\n        };\n      } catch (error) {\n        console.error(error);\n      }\n\n      return result;\n    },\n\n    onClickAway() {\n      this.reset();\n    },\n\n    reset() {\n      this.isBusy = false;\n      this.term = null;\n      this.pharmacies = [];\n      this.noResults = false;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.fuzzy-search-results {\n  max-height: 18rem;\n}\n</style>\n"]}]}