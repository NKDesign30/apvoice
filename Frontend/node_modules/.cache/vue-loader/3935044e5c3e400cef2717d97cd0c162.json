{"remainingRequest":"/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/src/components/survey/Survey.vue?vue&type=style&index=0&id=ea8a0f22&lang=scss&scoped=true&","dependencies":[{"path":"/app/src/components/survey/Survey.vue","mtime":1683275992563},{"path":"/app/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/app/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5zdXJ2ZXlfX2R1cmF0aW9uLS1wb3NpdGlvbiB7CiAgdG9wOiAyMyU7CiAgbGVmdDogMzAlOwp9Cgo="},{"version":3,"sources":["Survey.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAobA;AACA;AACA;AACA","file":"Survey.vue","sourceRoot":"src/components/survey","sourcesContent":["<template>\n  <div class=\"pb-16 survey\">\n    <div class=\"px-6 py-6 bg-yellow-200 survey-header tablet:px-0\">\n      <div class=\"container flex flex-wrap items-center tablet:justify-start justify-center\">\n        <!-- eslint-disable max-len -->\n        <div class=\"flex items-center justify-center text-xl font-bold text-yellow-500\">\n          <apo-icon\n            src=\"time\"\n            class=\"w-12 h-12\"\n          />\n          <span\n            class=\"mt-1 -ml-6 whitespace-no-wrap\"\n            v-text=\"duration\"\n          />\n        </div>\n        <!-- eslint-enable max-len -->\n\n        <div class=\"tablet:ml-8 text-gray-900\">\n          <h4\n            class=\"font-bold\"\n            v-html=\"$options.filters.formatContent(survey.title)\"\n          />\n          <p :inner-html=\"interpolate(survey.description) | formatContent\" />\n        </div>\n      </div>\n    </div>\n\n    <apo-survey-exit-page\n      v-if=\"isComplete\"\n      :survey=\"survey\"\n    />\n    <div\n      v-else\n      class=\"survey-body\"\n    >\n      <div class=\"container mt-16 tablet:mt-24\">\n        <h3\n          class=\"text-5xl text-center text-gray-900 font-display\"\n          v-text=\"$t('general.expertPoints', [survey.points])\"\n        />\n        <span\n          class=\"block text-3xl text-center text-gray-900 font-display\"\n          v-text=\"fullDuration\"\n        />\n      </div>\n\n      <apo-progress\n        class=\"mt-8 px-4 tablet:px-0\"\n        :chapter=\"chapter\"\n        :total-chapters=\"survey.chapters.length\"\n        :total-questions=\"totalQuestions\"\n        :answered-questions=\"answeredQuestions.length\"\n        sticky\n        @update-chapter=\"chapter = $event\"\n      />\n\n      <div class=\"container mx-auto mt-20 overflow-hidden chapter\">\n        <div class=\"flex flex-wrap justify-center\">\n          <div\n            v-for=\"(question) in currentChapter.questions\"\n            :key=\"question.id\"\n            class=\"flex flex-wrap items-end justify-center w-full px-4 mb-16 tablet:px-8\"\n          >\n            <component\n              :is=\"getSurveyComponent(question)\"\n              v-if=\"question.type !== 'question_cluster'\"\n              class=\"mx-6 text-center my-12\"\n              v-bind=\"question\"\n              :value=\"question.value\"\n              @input=\"onQuestionInput($event, question)\"\n            />\n\n            <small\n              v-if=\"getError(question) !== false\"\n              class=\"error mt-1 text-xs font-bold text-red-500 pin-l w-full text-center\"\n              v-text=\"getError(question)\"\n            />\n\n            <div\n              v-if=\"question.type === 'question_cluster'\"\n              class=\"survey-cluster-question w-full my-12\"\n            >\n              <div class=\"text-center survey-cluster-question__headlines mb-6\">\n                <h4\n                  class=\"text-3xl text-gray-900\"\n                  v-text=\"question.question\"\n                />\n                <p\n                  v-if=\"question.subheadline\"\n                  class=\"mt-2 italic text-gray-700 text-lg\"\n                  v-html=\"$options.filters.formatContent(question.subheadline)\"\n                />\n              </div>\n              <div class=\"flex flex-wrap justify-center\">\n                <div\n                  v-for=\"(clusterQuestion) in question.questions\"\n                  :key=\"clusterQuestion.id\"\n                  class=\"flex flex-wrap items-end justify-center\"\n                  :class=\"clusterQuestion.type === 'choice' || clusterQuestion.type === 'choice-multi' ? 'w-full' : 'w-auto'\"\n                >\n                  <div class=\"mx-6 mb-6 tablet:mb-12 w-full\">\n                    <component\n                      :is=\"getSurveyComponent(clusterQuestion)\"\n                      class=\"text-center\"\n                      is-cluster=\"true\"\n                      v-bind=\"clusterQuestion\"\n                      :value=\"clusterQuestion.value\"\n                      @input=\"onQuestionInput($event, clusterQuestion)\"\n                    />\n\n                    <small\n                      v-if=\"getError(clusterQuestion) !== false\"\n                      class=\"error mt-4 text-xs font-bold text-red-500 pin-l block text-center\"\n                      v-text=\"getError(clusterQuestion)\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div\n              v-if=\"question.isNested\"\n              class=\"w-full\"\n            >\n              <div\n                v-for=\"(nestedQuestion) in question.nestedQuestion\"\n                :key=\"nestedQuestion.id\"\n                class=\"flex flex-wrap items-end justify-center w-full \"\n              >\n                <div\n                  v-if=\"showNestedQuestion(nestedQuestion, question)\"\n                  class=\"w-full px-6 flex justify-center flex-wrap mt-16\"\n                >\n                  <component\n                    :is=\"getSurveyComponent(nestedQuestion)\"\n                    class=\"text-center my-12 w-full\"\n                    v-bind=\"nestedQuestion\"\n                    :value=\"nestedQuestion.value\"\n                    @input=\"onQuestionInput($event, nestedQuestion)\"\n                  />\n\n                  <small\n                    v-if=\"getError(nestedQuestion) !== false\"\n                    class=\"error mt-1 text-xs font-bold text-red-500 pin-l\"\n                    v-text=\"getError(nestedQuestion)\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"flex flex-wrap justify-center pb-4\">\n          <apo-button\n            v-if=\"!isFirstChapter\"\n            class=\"mr-6 text-gray-900 button button--naked shadow-hard\"\n            @click.native=\"onPreviousButtonClick\"\n            v-text=\"$t('general.back')\"\n          />\n\n          <apo-button\n            class=\"text-white button button--primary shadow-hard-dark\"\n            @click.native=\"onNextButtonClick\"\n            v-text=\"$t(`general.${isLastChapter ? 'submit' : 'continue'}`)\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport forEach from 'lodash/forEach';\nimport { mapGetters, mapActions } from 'vuex';\nimport { SURVEYS_STORE_RESULT } from '@/store/types/action-types';\nimport Progress from '@/components/ui/Progress.vue';\nimport SurveyAnswerMultiLineQuestion from '@/components/survey/SurveyAnswerMultiLineQuestion.vue';\nimport SurveyAnswerSingleLineQuestion from '@/components/survey/SurveyAnswerSingleLineQuestion.vue';\nimport SurveyRatingQuestion from '@/components/survey/SurveyRatingQuestion.vue';\nimport SurveyRatingIconsQuestion from '@/components/survey/SurveyRatingIconsQuestion.vue';\nimport SurveyPromoterScoreQuestion from '@/components/survey/SurveyPromoterScoreQuestion.vue';\nimport SurveyChoiceQuestion from '@/components/survey/SurveyChoiceQuestion.vue';\nimport SurveyMatrixQuestion from '@/components/survey/SurveyMatrixQuestion.vue';\nimport SurveyExitPage from '@/components/survey/SurveyExitPage.vue';\nimport SurveyChoiceMultiQuestion from '@/components/survey/SurveyChoiceMultiQuestion.vue';\nimport SurveyTextParagraphQuestion from './SurveyTextParagraphQuestion.vue';\nimport SurveyMapper from '@/services/mapper/SurveyMapper';\nimport SurveyValidation from '@/services/survey/SurveyValidation';\nimport SurveyChapterValidation from '@/services/survey/SurveyChapterValidation';\n\nexport default {\n  components: {\n    'apo-progress': Progress,\n    'apo-survey-answer-multi-line-question': SurveyAnswerMultiLineQuestion,\n    'apo-survey-answer-single-line-question': SurveyAnswerSingleLineQuestion,\n    'apo-survey-choice-question': SurveyChoiceQuestion,\n    'apo-survey-matrix-question': SurveyMatrixQuestion,\n    'apo-survey-choice-multi-question': SurveyChoiceMultiQuestion,\n    'apo-survey-rating-question': SurveyRatingQuestion,\n    'apo-survey-rating_icons-question': SurveyRatingIconsQuestion,\n    'apo-survey-promoter_score-question': SurveyPromoterScoreQuestion,\n    'apo-survey-text-paragraph-question': SurveyTextParagraphQuestion,\n    'apo-survey-exit-page': SurveyExitPage,\n  },\n\n  props: {\n    survey: {\n      type: Object,\n      required: true,\n    },\n  },\n\n  data() {\n    return {\n      chapter: 1,\n      validation: new SurveyValidation(),\n      answeredQuestions: [],\n    };\n  },\n\n  computed: {\n    ...mapGetters(['userId', 'user']),\n\n    duration() {\n      const { type, time: amount } = this.survey.duration;\n\n      return this.$tc(`general.time.short.${type}`, amount, { amount });\n    },\n\n    fullDuration() {\n      const { type, time: amount } = this.survey.duration;\n\n      return this.$tc(`general.time.full.${type}`, amount, { amount });\n    },\n\n    currentChapter() {\n      return this.survey.chapters[this.chapter - 1];\n    },\n\n    isFirstChapter() {\n      return this.chapter === 1;\n    },\n\n    isLastChapter() {\n      return this.chapter === this.survey.chapters.length;\n    },\n\n    isComplete() {\n      return (this.user.surveyResults[this.survey.id] !== undefined && this.user.surveyResults[this.survey.id].is_complete);\n    },\n\n    totalQuestions() {\n      return this.currentChapter.questions.reduce((accumulator, question) => {\n        if (question.type === 'rating') {\n          return accumulator + question.items.length;\n        }\n        return accumulator + 1;\n      }, 0);\n    },\n  },\n\n  methods: {\n    ...mapActions([SURVEYS_STORE_RESULT]),\n\n    interpolate(text) {\n      const replacements = {\n        survey_points: this.survey.points,\n      };\n\n      forEach(replacements, (value, key) => {\n        const regex = new RegExp(`{${key}}`, 'g');\n\n        // eslint-disable-next-line no-param-reassign\n        text = text.replace(regex, value);\n      });\n\n      return text;\n    },\n\n    validateCurrentChapter() {\n      this.validation.resetChapter(this.chapter);\n\n      const chapterValidation = new SurveyChapterValidation();\n\n      this.currentChapter.questions.forEach(question => {\n        if (question.isOptional) {\n          return;\n        }\n\n        if (question.type === 'question_cluster') {\n          question.questions.forEach(clusterQuestion => {\n            if (clusterQuestion.isOptional) {\n              return;\n            }\n            this.validateQuestion(clusterQuestion, chapterValidation);\n          });\n        } else this.validateQuestion(question, chapterValidation);\n\n        if (question.isNested) {\n          question.nestedQuestion.forEach(nestedQuestion => {\n            if (nestedQuestion.isOptional || !this.showNestedQuestion(nestedQuestion, question)) {\n              return;\n            }\n\n            this.validateQuestion(nestedQuestion, chapterValidation);\n          });\n        }\n      });\n\n      this.validation.setChapter(this.chapter, chapterValidation);\n    },\n\n    validateQuestion(question, chapterValidation) {\n      let isValid = true;\n\n      switch (question.type) {\n        case 'choice-multi':\n          isValid = question.value.length > 0;\n          break;\n\n        case 'rating':\n          isValid = question.value.length === question.items.length;\n          break;\n\n        case 'matrix':\n          isValid = Object.keys(question.value).length === question.sections.length;\n          break;\n\n        default:\n          isValid = question.value !== undefined && question.value !== '';\n      }\n\n      if (!isValid) {\n        chapterValidation.add(question.id, this.$t('surveys.messages.questionIsRequired'));\n      }\n    },\n\n    getError({ id }) {\n      if (!this.validation.hasChapter(this.chapter)) {\n        return false;\n      }\n\n      if (!this.validation.getChapter(this.chapter).has(id)) {\n        return false;\n      }\n\n      window.setTimeout(() => {\n        window.scrollTo({ top: document.getElementsByClassName('error')[0].parentElement.offsetTop - 60, behavior: 'smooth' });\n      }, 500);\n      return this.validation.getChapter(this.chapter).get(id);\n    },\n\n    resetError({ id }) {\n      if (!this.validation.hasChapter(this.chapter)) {\n        return false;\n      }\n\n      return this.validation.getChapter(this.chapter).remove(id);\n    },\n\n    getSurveyComponent({ type }) {\n      return `apo-survey-${type}-question`;\n    },\n\n    onQuestionInput(event, question) {\n      if (question.type === 'rating') {\n        if (question.value.some(value => value.ratingId === event.item.id)) {\n          const index = question.value.findIndex(value => value.ratingId === event.item.id);\n          // eslint-disable-next-line no-param-reassign\n          question.value[index].value = event.value;\n        } else {\n          question.value.push({ ratingId: event.item.id, value: event.value });\n        }\n        this.answeredQuestions.push(event.item.id);\n      } else {\n        if (this.answeredQuestions.indexOf(question.id) === -1) {\n          this.answeredQuestions.push(question.id);\n        } else if (!event) {\n          this.answeredQuestions = this.answeredQuestions.filter(id => id !== question.id);\n        }\n        // eslint-disable-next-line no-param-reassign\n        question.value = event;\n      }\n      if (this.validation.hasChapter(this.chapter)) {\n        this.validateCurrentChapter();\n        this.$forceUpdate();\n      }\n    },\n\n    showNestedQuestion(nestedQuestion, question) {\n      return nestedQuestion.parentValue.split(',').find(e => e === question.value || (typeof question.value === 'object' && question.value.some(val => val.value === e || val === e)));\n    },\n\n    onPreviousButtonClick() {\n      if (!this.isFirstChapter) {\n        this.chapter = this.chapter - 1;\n      }\n    },\n\n    onNextButtonClick() {\n      this.validateCurrentChapter();\n\n      if (this.validation.hasChapter(this.chapter)\n        && !this.validation.getChapter(this.chapter).isValid) {\n        this.$forceUpdate();\n\n        return;\n      }\n\n      if (this.isLastChapter) {\n        const params = {\n          user_id: String(this.userId),\n          survey_id: String(this.survey.id),\n        };\n\n        this[SURVEYS_STORE_RESULT](SurveyMapper.createSurveyPayload(this.survey, params))\n          .then(survey => {\n            this.user.surveyResults[survey.id] = { is_complete: survey.is_complete, result: survey.result };\n          })\n          .catch(error => {\n            console.log('error storing result', error);\n          });\n\n        return;\n      }\n\n      this.chapter = this.chapter + 1;\n    },\n  },\n};\n\n</script>\n\n<style lang=\"scss\" scoped>\n\n.survey__duration--position {\n  top: 23%;\n  left: 30%;\n}\n\n</style>\n"]}]}