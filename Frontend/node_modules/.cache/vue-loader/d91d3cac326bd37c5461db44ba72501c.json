{"remainingRequest":"/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/src/components/content/text-media-paragraph/media-slot/TextMediaParagraphMediaSlotChart.vue?vue&type=style&index=0&id=4509fa92&lang=scss&scoped=true&","dependencies":[{"path":"/app/src/components/content/text-media-paragraph/media-slot/TextMediaParagraphMediaSlotChart.vue","mtime":1683275992558},{"path":"/app/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/app/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5jaGFydC1jb250YWluZXIgewogIG1heC1oZWlnaHQ6IGNhbGModGhlbWUoJ3NwYWNpbmcuNzInKSAqIDIpOwp9Cgo="},{"version":3,"sources":["TextMediaParagraphMediaSlotChart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqLA;AACA;AACA","file":"TextMediaParagraphMediaSlotChart.vue","sourceRoot":"src/components/content/text-media-paragraph/media-slot","sourcesContent":["<template>\n  <div class=\"text-media-paragraph__media-slot--chart\">\n    <div class=\"chart-container mb-3\">\n      <apo-bar-char\n        v-if=\"isContentVisible\"\n        :chartdata=\"chartdata\"\n        :options=\"options\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport get from 'lodash/get';\nimport map from 'lodash/map';\nimport { Chart } from 'chart.js';\n// eslint-disable-next-line no-unused-vars\nimport ChartDataLabels from 'chartjs-plugin-datalabels';\nimport Bar from '@/components/charts/Bar.vue';\nimport { hexToRgb, colorBrightness } from '@/services/utils';\n\nconst tailwindColors = require('../../../../tailwind/Colors');\n\nexport default {\n  components: {\n    'apo-bar-char': Bar,\n  },\n\n  inject: {\n    pageIndicatorState: {\n      default: null,\n    },\n  },\n\n  props: {\n    media: {\n      type: Array,\n      required: false,\n      default() {\n        return [];\n      },\n    },\n  },\n\n  data() {\n    return {\n      options: {\n        legend: {\n          display: false,\n        },\n\n        tooltips: {\n          enabled: false,\n        },\n\n        scales: {\n          yAxes: [{\n            ticks: {\n              beginAtZero: true,\n            },\n          }],\n        },\n\n        layout: {\n          padding: {\n            top: 25,\n          },\n        },\n\n        maintainAspectRatio: false,\n\n        animation: {\n          onProgress() {\n            const chartInstance = this.chart;\n            const { ctx } = chartInstance;\n\n            // Create Font String\n            ctx.font = Chart.helpers.fontString(\n              Chart.defaults.global.defaultFontSize,\n              Chart.defaults.global.defaultFontStyle,\n              Chart.defaults.global.defaultFontFamily,\n            );\n            ctx.textAlign = 'center';\n            ctx.textBaseline = 'bottom';\n\n            // Iterate over all bars\n            this.data.datasets.forEach((dataset, datasetIndex) => {\n              const meta = chartInstance.controller.getDatasetMeta(datasetIndex);\n\n              meta.data.forEach((bar, barIndex) => {\n                // Check if the bar has a value (i.e. is not hidden)\n                if (dataset.data[barIndex] !== '' && dataset.data[barIndex] > 0) {\n                  // Check if the bar has a custom label and draw it\n                  const customLabel = dataset.customLabels[barIndex];\n\n                  if (customLabel && customLabel !== '' && customLabel.length > 0) {\n                    // eslint-disable-next-line no-underscore-dangle\n                    ctx.fillText(customLabel, bar._model.x, bar._model.y - 5);\n                  }\n                }\n              });\n            });\n          },\n        },\n      },\n    };\n  },\n\n  computed: {\n    chartdata() {\n      return {\n        labels: this.getLabels(this.media),\n        datasets: this.getDatasets(this.media),\n      };\n    },\n\n    isContentVisible() {\n      if (this.pageIndicatorState === null) {\n        return true;\n      }\n\n      return this.pageIndicatorState.isOpen;\n    },\n  },\n\n  methods: {\n    getLabels(media) {\n      return map(media, 'description');\n    },\n\n    getDatasets(media) {\n      const datasets = [];\n\n      media.forEach((data, datasetIndex) => {\n        data.bars.forEach((bar, barIndex) => {\n          if (!datasets[barIndex]) {\n            const { red, green, blue } = hexToRgb(this.getTailwindColor(bar.color));\n            const brightness = colorBrightness(red, green, blue);\n            const color = brightness < 123 ? '#ffffff' : '#000000';\n\n            datasets[barIndex] = {\n              label: '',\n              data: [],\n              backgroundColor: [],\n              datalabels: {\n                align: 'center',\n                anchor: 'center',\n                color,\n              },\n              customLabels: [],\n            };\n          }\n\n          datasets[barIndex].data[datasetIndex] = parseFloat(bar.value);\n          datasets[barIndex].backgroundColor[datasetIndex] = this.getTailwindColor(bar.color);\n          datasets[barIndex].customLabels[datasetIndex] = bar.label || '';\n        });\n      });\n\n      datasets.forEach((dataset, datasetIndex) => {\n        for (let i = 0; i < media.length; i += 1) {\n          if (datasets[datasetIndex].data[i] === undefined) {\n            datasets[datasetIndex].data[i] = '';\n            datasets[datasetIndex].backgroundColor[i] = 'transparent';\n          }\n        }\n      });\n\n      return datasets;\n    },\n\n    getTailwindColor(color) {\n      return get(tailwindColors, color.replace(/-/, '.'));\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n\n.chart-container {\n  max-height: calc(theme('spacing.72') * 2);\n}\n\n</style>\n"]}]}