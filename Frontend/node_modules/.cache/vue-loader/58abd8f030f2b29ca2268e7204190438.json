{"remainingRequest":"/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/src/components/form-renderer/PharmaciesFuzzySearch.vue?vue&type=script&lang=js&","dependencies":[{"path":"/app/src/components/form-renderer/PharmaciesFuzzySearch.vue","mtime":1683275992559},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1peGluIGFzIGNsaWNrYXdheSB9IGZyb20gInZ1ZS1jbGlja2F3YXkiOwppbXBvcnQgSW5wdXRMYWJlbCBmcm9tICJAL2NvbXBvbmVudHMvZm9ybS1yZW5kZXJlci9JbnB1dExhYmVsLnZ1ZSI7CmltcG9ydCBUZXh0SW5wdXQgZnJvbSAiQC9jb21wb25lbnRzL2Zvcm0tcmVuZGVyZXIvVGV4dElucHV0LnZ1ZSI7CmltcG9ydCBGdXp6eVNlYXJjaFNlcnZpY2UgZnJvbSAiQC9zZXJ2aWNlcy9hcGkvRnV6enlTZWFyY2hTZXJ2aWNlIjsKaW1wb3J0IHsgbWFwU3RhdGUsIG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IFVzZXJTZXJ2aWNlIGZyb20gIkAvc2VydmljZXMvYXBpL1VzZXJTZXJ2aWNlIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJQaGFybWFjaWVzRnV6enlTZWFyY2giLAoKICBjb21wb25lbnRzOiB7CiAgICAiYXBvLWlucHV0LWxhYmVsIjogSW5wdXRMYWJlbCwKICAgICJhcG8tdGV4dC1pbnB1dCI6IFRleHRJbnB1dAogIH0sCgogIG1peGluczogW2NsaWNrYXdheV0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpc0J1c3k6IGZhbHNlLAogICAgICB0ZXJtOiBudWxsLAogICAgICBkZWJvdW5jZVRpbWVyOiBudWxsLAogICAgICBwaGFybWFjaWVzOiBbXSwKICAgICAgbm9SZXN1bHRzOiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsibGFuZ3VhZ2UiXSkKICB9LAogIG1ldGhvZHM6IHsKICAgIGxhbmd1YWdlKCkgewogICAgICByZXR1cm4gdGhpcy5sYW5ndWFnZTsKICAgIH0sCgogICAgc2VhcmNoKCkgewogICAgICB0aGlzLm5vUmVzdWx0cyA9IGZhbHNlOwoKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVib3VuY2VUaW1lcik7CiAgICAgIHRoaXMuZGVib3VuY2VUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmICh0aGlzLnNlYXJjaCkgewogICAgICAgICAgaWYgKHdpbmRvdy5mdXp6eVNlYXJjaENhbmNlbFRva2VuKSB7CiAgICAgICAgICAgIHdpbmRvdy5mdXp6eVNlYXJjaENhbmNlbFRva2VuLmNhbmNlbCgpOwogICAgICAgICAgfQogICAgICAgICAgLy8gc2V0IGJ1c3kgc3RhdGUgaW4gbmV4dCB0aWNrIHRvIGhhbmRsZSBjYW5jZWxkIHJlcXVlc3RzCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0J1c3kgPSB0cnVlOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgICBGdXp6eVNlYXJjaFNlcnZpY2UuZmV0Y2goZGVjb2RlVVJJQ29tcG9uZW50KHRoaXMudGVybSkpCiAgICAgICAgICAgIC50aGVuKCh7IHJlc3VsdHMgfSkgPT4gewogICAgICAgICAgICAgIHRoaXMubm9SZXN1bHRzID0gcmVzdWx0cy5sZW5ndGggPT09IDA7CiAgICAgICAgICAgICAgdGhpcy5waGFybWFjaWVzID0gcmVzdWx0czsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpCiAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmlzQnVzeSA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sIDE1MCk7CiAgICB9LAoKICAgIHNlbGVjdChwaGFybWFjeSkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIHRoaXMudGVybSA9IHBoYXJtYWN5OwogICAgICBjb25zb2xlLmxvZyh0aGlzLmV4dHJhY3RGcm9tU3RyaW5nKHBoYXJtYWN5KSk7CiAgICAgIHRoaXMuJGVtaXQoInNlbGVjdGVkIiwgdGhpcy5leHRyYWN0RnJvbVN0cmluZyhwaGFybWFjeSkpOwogICAgfSwKCiAgICBleHRyYWN0RnJvbVN0cmluZyhwaGFybWFjeSkgewogICAgICBsZXQgcmVzdWx0ID0gbnVsbDsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBbbmFtZSwgc3RyZWV0V2l0aE51bWJlciwgemlwLCBjaXR5XSA9IHBoYXJtYWN5LnNwbGl0KCIsIikubWFwKHJvdyA9PiByb3cudHJpbSgpKTsKICAgICAgICBjb25zdCBtYXRjaCA9IHN0cmVldFdpdGhOdW1iZXIubWF0Y2goL1xkLyk7CiAgICAgICAgY29uc3Qgc3RyZWV0ID0gc3RyZWV0V2l0aE51bWJlci5zdWJzdHIoMCwgbWF0Y2guaW5kZXgpLnRyaW0oKTsKICAgICAgICBjb25zdCBudW1iZXIgPSBzdHJlZXRXaXRoTnVtYmVyLnN1YnN0cihtYXRjaC5pbmRleCkudHJpbSgpOwoKICAgICAgICByZXN1bHQgPSB7CiAgICAgICAgICBuYW1lLAogICAgICAgICAgc3RyZWV0LAogICAgICAgICAgbnVtYmVyLAogICAgICAgICAgemlwLAogICAgICAgICAgY2l0eQogICAgICAgIH07CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIG9uQ2xpY2tBd2F5KCkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICB9LAoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmlzQnVzeSA9IGZhbHNlOwogICAgICB0aGlzLnRlcm0gPSBudWxsOwogICAgICB0aGlzLnBoYXJtYWNpZXMgPSBbXTsKICAgICAgdGhpcy5ub1Jlc3VsdHMgPSBmYWxzZTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["PharmaciesFuzzySearch.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PharmaciesFuzzySearch.vue","sourceRoot":"src/components/form-renderer","sourcesContent":["<template>\n  <div v-on-clickaway=\"onClickAway\" class=\"relative w-11/12 mx-auto tablet:w-full\">\n    <apo-input-label\n      for=\"pharmacy-fuzzy-serach\"\n      class=\"mb-4\"\n      v-text=\"$t('general.pharmacySearch')\"\n    />\n    <apo-text-input\n      id=\"pharmacy-fuzzy-serach\"\n      v-model=\"term\"\n      :placeholder=\"$t('general.fuzzySearch.placeholder')\"\n      @input=\"search\"\n    >\n      <template #after>\n        <div class=\"absolute right-0 mr-8\">\n          <apo-spinner v-if=\"isBusy\" size=\"small\" />\n        </div>\n      </template>\n    </apo-text-input>\n    <ul\n      v-if=\"pharmacies.length > 0 || noResults\"\n      class=\"absolute z-50 w-full mt-1 overflow-auto bg-white border-2 shadow-2xl fuzzy-search-results\"\n    >\n      <li v-if=\"noResults\" class=\"px-4 py-3 border-b-2 tablet:px-3\" tabindex=\"0\">\n        {{ $t(\"general.noResults\") }}\n      </li>\n      <li\n        v-for=\"(pharmacy, index) in pharmacies\"\n        :key=\"`pharmacy-result-${index}`\"\n        class=\"px-4 py-3 border-b-2 cursor-pointer tablet:px-3 hover:bg-blue-100\"\n        tabindex=\"0\"\n        @click=\"select(pharmacy)\"\n        @keydown.enter=\"select(pharmacy)\"\n      >\n        {{ pharmacy }}\n      </li>\n    </ul>\n    <slot />\n  </div>\n</template>\n\n<script>\nimport { mixin as clickaway } from \"vue-clickaway\";\nimport InputLabel from \"@/components/form-renderer/InputLabel.vue\";\nimport TextInput from \"@/components/form-renderer/TextInput.vue\";\nimport FuzzySearchService from \"@/services/api/FuzzySearchService\";\nimport { mapState, mapGetters } from \"vuex\";\nimport UserService from \"@/services/api/UserService\";\nexport default {\n  name: \"PharmaciesFuzzySearch\",\n\n  components: {\n    \"apo-input-label\": InputLabel,\n    \"apo-text-input\": TextInput\n  },\n\n  mixins: [clickaway],\n\n  data() {\n    return {\n      isBusy: false,\n      term: null,\n      debounceTimer: null,\n      pharmacies: [],\n      noResults: false\n    };\n  },\n  computed: {\n    ...mapGetters([\"language\"])\n  },\n  methods: {\n    language() {\n      return this.language;\n    },\n\n    search() {\n      this.noResults = false;\n\n      clearTimeout(this.debounceTimer);\n      this.debounceTimer = setTimeout(() => {\n        if (this.search) {\n          if (window.fuzzySearchCancelToken) {\n            window.fuzzySearchCancelToken.cancel();\n          }\n          // set busy state in next tick to handle canceld requests\n          setTimeout(() => {\n            this.isBusy = true;\n          }, 0);\n          FuzzySearchService.fetch(decodeURIComponent(this.term))\n            .then(({ results }) => {\n              this.noResults = results.length === 0;\n              this.pharmacies = results;\n            })\n            .catch(console.error)\n            .finally(() => {\n              this.isBusy = false;\n            });\n        }\n      }, 150);\n    },\n\n    select(pharmacy) {\n      this.reset();\n      this.term = pharmacy;\n      console.log(this.extractFromString(pharmacy));\n      this.$emit(\"selected\", this.extractFromString(pharmacy));\n    },\n\n    extractFromString(pharmacy) {\n      let result = null;\n      try {\n        const [name, streetWithNumber, zip, city] = pharmacy.split(\",\").map(row => row.trim());\n        const match = streetWithNumber.match(/\\d/);\n        const street = streetWithNumber.substr(0, match.index).trim();\n        const number = streetWithNumber.substr(match.index).trim();\n\n        result = {\n          name,\n          street,\n          number,\n          zip,\n          city\n        };\n      } catch (error) {\n        console.error(error);\n      }\n\n      return result;\n    },\n\n    onClickAway() {\n      this.reset();\n    },\n\n    reset() {\n      this.isBusy = false;\n      this.term = null;\n      this.pharmacies = [];\n      this.noResults = false;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.fuzzy-search-results {\n  max-height: 18rem;\n}\n</style>\n"]}]}