{"remainingRequest":"/app/node_modules/vue-loader/lib/index.js??vue-loader-options!/app/src/components/training/quiz/TrainingQuiz.vue?vue&type=style&index=0&id=528773f8&lang=scss&scoped=true&","dependencies":[{"path":"/app/src/components/training/quiz/TrainingQuiz.vue","mtime":1683275992567},{"path":"/app/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/app/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZm9yY2UtZnVsbC13aWR0aCB7CiAgbWFyZ2luLWxlZnQ6IGNhbGMoLTUwdncgKyA1MCUpOwogIHdpZHRoOiAxMDB2dzsKfQoKLnRoZW1lLXRyYWluaW5nIHsKICAuYmFja2dyb3VuZC1jbGFzcyB7CiAgICBAYXBwbHkgYmctdHJhaW5pbmctNTA7CiAgfQp9Ci50aGVtZS1zY2llbnRpZmljIHsKICAuYmFja2dyb3VuZC1jbGFzcyB7CiAgICBAYXBwbHkgYmctc2NpZW50aWZpYy01MDsKICB9Cn0K"},{"version":3,"sources":["TrainingQuiz.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2MA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TrainingQuiz.vue","sourceRoot":"src/components/training/quiz","sourcesContent":["<template>\n  <div class=\"p-12 mt-24 training-quiz force-full-width background-class\">\n    <div\n      v-if=\"headline || subheadline\"\n      class=\"container text-gray-900 training-quiz__headlines mb-7\"\n    >\n      <h2\n        class=\"text-center\"\n        v-html=\"$options.filters.formatContent(headline)\"\n      />\n\n      <h3\n        v-if=\"subheadline\"\n        class=\"mt-6 text-center\"\n        v-html=\"$options.filters.formatContent(subheadline)\"\n      />\n    </div>\n    <div class=\"container training-quiz__body\">\n      <apo-training-quiz-item\n        :quiz=\"currentChapter\"\n        :is-last-chapter=\"isLastChapter\"\n        @submit-answer=\"processAnswer\"\n        @update-chapter=\"updateChapter\"\n      >\n        <apo-progress\n          class=\"mt-4\"\n          :chapter=\"chapter\"\n          :total-chapters=\"chapters.length\"\n          :interactive=\"false\"\n        />\n      </apo-training-quiz-item>\n      <apo-references\n        class=\"mt-8\"\n        :references=\"currentChapter.references\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapMutations } from 'vuex';\nimport {\n  AUTH_UPDATE_USER,\n  TRAININGS_UPDATE_ONE_TRAINING_SERIES,\n} from '@/store/types/mutation-types';\nimport { AUTH_FETCH_CURRENT_USER, AUTH_FETCH_USER_LEVEL_DATA } from '@/store/types/action-types';\nimport TrainingQuizItem from '@/components/training/quiz/TrainingQuizItem.vue';\nimport Progress from '@/components/ui/Progress.vue';\nimport TrainingMapper from '@/services/mapper/TrainingMapper';\nimport TrainingService from '@/services/api/TrainingService';\nimport TrainingSeriesService from '@/services/api/TrainingSeriesService';\n\nexport default {\n  inject: ['pageIndicatorsState', 'trainingsState'],\n\n  components: {\n    'apo-training-quiz-item': TrainingQuizItem,\n    'apo-progress': Progress,\n  },\n  props: {\n    trainingSeriesId: {\n      required: true,\n      validator: prop => typeof prop === 'number' || prop === null,\n    },\n    trainingId: {\n      required: true,\n      validator: prop => typeof prop === 'number' || prop === null,\n    },\n    lesson_id: {\n      type: String,\n      required: true,\n    },\n    headline: {\n      type: String,\n      required: false,\n      default: '',\n    },\n    subheadline: {\n      type: String,\n      required: false,\n      default: '',\n    },\n    chapters: {\n      type: Array,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      chapter: 1,\n      answers: [],\n    };\n  },\n  computed: {\n    ...mapGetters(['userId', 'user']),\n\n    currentChapter() {\n      return this.chapters[this.chapter - 1];\n    },\n\n    isFirstChapter() {\n      return this.chapter === 1;\n    },\n\n    isLastChapter() {\n      return this.chapter === this.chapters.length;\n    },\n  },\n  methods: {\n    ...mapMutations([AUTH_UPDATE_USER, TRAININGS_UPDATE_ONE_TRAINING_SERIES]),\n\n    processAnswer(answer) {\n      const currentAnswer = {\n        ...answer,\n        chapter: {\n          id: this.currentChapter.id,\n          chapter: this.chapter,\n        },\n      };\n      this.answers.push(currentAnswer);\n    },\n    updateChapter() {\n      if (this.isLastChapter) {\n        this.checkRequirements();\n        return;\n      }\n      this.chapter += 1;\n    },\n    checkRequirements() {\n      if (this.hasRequiredElementsFilled()) {\n        this.storeAnswers();\n      }\n    },\n    hasRequiredElementsFilled() {\n      const element = this.trainingsState.requiredElements.find(\n        state => !state.hasSubmitted,\n      );\n      if (element) {\n        this.pageIndicatorsState.activePageIndicator = element.pageIndicatorId;\n        this.trainingsState.currentMissingElement = element.question_id;\n        return false;\n      }\n      return true;\n    },\n    storeAnswers() {\n      // eslint-disable-next-line camelcase\n      const { id, lesson_id } = this.$route.params;\n      const params = {\n        user_id: this.userId,\n        training_id: this.trainingId,\n        lesson_id,\n        training_series_id: this.trainingSeriesId,\n      };\n      this.$store.dispatch('wait/start', 'submitTrainingQuiz', { root: true });\n      TrainingService.storeLessonResults(\n        TrainingMapper.createPayload(this.answers, params),\n      )\n        .then(response => {\n          const copiedUser = this.user;\n          const completedLessons = {};\n          response.result.forEach(item => {\n            completedLessons[item.lesson_id] = item.lesson_id;\n          });\n          copiedUser.trainingResults[response.training_id] = {\n            is_complete: response.is_complete,\n            completed_lessons: completedLessons,\n          };\n          this[AUTH_UPDATE_USER](copiedUser);\n          //this[AUTH_FETCH_USER_LEVEL_DATA](); // update user's points earned - ApoUserLevels plugin\n          this.$store.dispatch(AUTH_FETCH_CURRENT_USER);\n\n          TrainingSeriesService.fetch(this.trainingSeriesId).then(\n            trainingSeries => {\n              this[TRAININGS_UPDATE_ONE_TRAINING_SERIES](trainingSeries);\n              this.$store.dispatch('wait/end', 'submitTrainingQuiz', { root: true });\n              this.$store.dispatch(AUTH_FETCH_USER_LEVEL_DATA, {})\n              this.$router.push({\n                name: 'training-success-page',\n                params: {\n                  slug: trainingSeries.slug,\n                  series_id: this.trainingSeriesId,\n                  id,\n                  lesson_id,\n                  origin: this.$route.name\n                },\n              });\n            },\n          );\n        })\n        .catch(error => {\n          this.$store.dispatch('wait/end', 'submitTrainingQuiz', { root: true });\n          console.log('error storing training lesson result', error);\n        });\n    },\n  },\n  destroyed() {\n    this.answers = [];\n    this.chapter = 1;\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n  .force-full-width {\n    margin-left: calc(-50vw + 50%);\n    width: 100vw;\n  }\n\n  .theme-training {\n    .background-class {\n      @apply bg-training-50;\n    }\n  }\n  .theme-scientific {\n    .background-class {\n      @apply bg-scientific-50;\n    }\n  }\n</style>\n"]}]}