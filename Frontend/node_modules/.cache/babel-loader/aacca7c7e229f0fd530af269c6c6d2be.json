{"remainingRequest":"/app/node_modules/babel-loader/lib/index.js!/app/node_modules/eslint-loader/index.js??ref--13-0!/app/src/events.js","dependencies":[{"path":"/app/src/events.js","mtime":1683275992571},{"path":"/app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/app/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnOwppbXBvcnQgeyBBVVRIX0ZFVENIX0NVUlJFTlRfVVNFUiwgUEhBUk1BQ0lFU19GRVRDSF9QSEFSTUFDSUVTLCBERVRBSUxFUlNfSk9CX0ZFVENIX0lORk9STUFUSU9OQUxfVFJBSU5JTkdTLCBERVRBSUxFUlNfSk9CX0ZFVENIX1NBVkVEX1NUQVRFUywgUEFHRVNfRkVUQ0hfUEFHRV9QRVJNSVNTSU9OUywgQVVUSF9SRUZSRVNIIH0gZnJvbSAiLi9zdG9yZS90eXBlcy9hY3Rpb24tdHlwZXMiOwoKdmFyIHJlZnJlc2hBeGlvc0luc3RhbmNlID0gZnVuY3Rpb24gcmVmcmVzaEF4aW9zSW5zdGFuY2UoKSB7CiAgaWYgKHN0b3JlLmdldHRlcnMuaXNBdXRoZW50aWNhdGVkKSB7CiAgICB3aW5kb3cuYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbiA9ICJCZWFyZXIgIi5jb25jYXQoc3RvcmUuc3RhdGUuYXV0aC50b2tlbi5yYXcpOwogICAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZXJzY29yZS1kYW5nbGUgKi8KCiAgICBpZiAod2luZG93Ll90b2tlbkFjY2Vzc1RpbWVyKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwod2luZG93Ll90b2tlbkFjY2Vzc1RpbWVyKTsKICAgIH0KCiAgICB3aW5kb3cuX3Rva2VuQWNjZXNzVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKEFVVEhfUkVGUkVTSCk7CiAgICB9LCAxMDAwICogNjAgKiAyNSk7CiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVuZGVyc2NvcmUtZGFuZ2xlICovCiAgfSBlbHNlIHsKICAgIGRlbGV0ZSB3aW5kb3cuYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb24uQXV0aG9yaXphdGlvbjsKICB9Cn07Cgp3aW5kb3cuZXZlbnRCdXMuJG9uKCdhdXRoZW50aWNhdGVkJywgZnVuY3Rpb24gKCkgewogIGNvbnNvbGUubG9nKCdVc2VyIGhhcyBiZWVuIGF1dGhlbnRpY2F0ZWQuLi4nKTsgLy8gU2V0IGF1dGhvcml6YXRpb24gaGVhZGVycwoKICByZWZyZXNoQXhpb3NJbnN0YW5jZSgpOyAvLyBJbiB0aGUgU1RBR0lORyBlbnZpcm9ubWVudCB0aGVyZSBpcyBIVFRQIEJhc2ljIEF1dGggZW5hYmxlZCwgd2hpY2gKICAvLyBvdmVyd3JpdGVzIHRoZSBBdXRob3JpemF0aW9uIGhlYWRlcnMuIEluIG9yZGVyIGZvciBXb3JkcHJlc3MgdG8gZnVuY3Rpb24KICAvLyBjb3JyZWN0bHksIHdlIG5lZWQgdG8gcHJvdmlkZSB0aGUgQXV0aCB0b2tlbiBpbiBhbiBleHRyYSBoZWFkZXIsIHdoaWNoCiAgLy8gaXMgdGhlbiB1c2VkIGJ5IE5naW54IHRvIG92ZXJ3cml0ZSB0aGUgQXV0aG9yaXphdGlvbiBoZWFkZXIgd2l0aCB0aGF0IHZhbHVlLgoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdkZXZlbG9wbWVudCcgJiYgcHJvY2Vzcy5lbnYuVlVFX0FQUF9XSVRIX1hfQVVUSE9SSVpBVElPTl9IRUFERVIgPT09ICd0cnVlJykgewogICAgd2luZG93LmF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLUFQTy1BVVRIJ10gPSAiQmVhcmVyICIuY29uY2F0KHN0b3JlLnN0YXRlLmF1dGgudG9rZW4ucmF3KTsKICB9IC8vIExvYWQgc3RhdGUgdGhhdCByZXF1aXJlcyBhbiBhdXRoZW50aWNhdGVkIHVzZXIKCgogIHN0b3JlLmRpc3BhdGNoKEFVVEhfRkVUQ0hfQ1VSUkVOVF9VU0VSKTsKICBzdG9yZS5kaXNwYXRjaChQQUdFU19GRVRDSF9QQUdFX1BFUk1JU1NJT05TKTsKICBzdG9yZS5kaXNwYXRjaChQSEFSTUFDSUVTX0ZFVENIX1BIQVJNQUNJRVMpOwogIHN0b3JlLmRpc3BhdGNoKERFVEFJTEVSU19KT0JfRkVUQ0hfSU5GT1JNQVRJT05BTF9UUkFJTklOR1MpOwogIHN0b3JlLmRpc3BhdGNoKERFVEFJTEVSU19KT0JfRkVUQ0hfU0FWRURfU1RBVEVTKTsKfSk7CndpbmRvdy5ldmVudEJ1cy4kb24oJ3JlY2l2ZWRBY2Nlc3NUb2tlbicsIGZ1bmN0aW9uICgpIHsKICByZWZyZXNoQXhpb3NJbnN0YW5jZSgpOwp9KTs="},{"version":3,"sources":["/app/src/events.js"],"names":["store","AUTH_FETCH_CURRENT_USER","PHARMACIES_FETCH_PHARMACIES","DETAILERS_JOB_FETCH_INFORMATIONAL_TRAININGS","DETAILERS_JOB_FETCH_SAVED_STATES","PAGES_FETCH_PAGE_PERMISSIONS","AUTH_REFRESH","refreshAxiosInstance","getters","isAuthenticated","window","axios","defaults","headers","common","Authorization","state","auth","token","raw","_tokenAccessTimer","clearInterval","setInterval","dispatch","eventBus","$on","console","log","process","env","NODE_ENV","VUE_APP_WITH_X_AUTHORIZATION_HEADER"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,SAAlB;AACA,SACEC,uBADF,EAEEC,2BAFF,EAGEC,2CAHF,EAIEC,gCAJF,EAKEC,4BALF,EAMEC,YANF;;AASA,IAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,GAAM;AACjC,MAAIP,KAAK,CAACQ,OAAN,CAAcC,eAAlB,EAAmC;AACjCC,IAAAA,MAAM,CAACC,KAAP,CAAaC,QAAb,CAAsBC,OAAtB,CAA8BC,MAA9B,CAAqCC,aAArC,oBAA+Df,KAAK,CAACgB,KAAN,CAAYC,IAAZ,CAAiBC,KAAjB,CAAuBC,GAAtF;AACA;;AACA,QAAIT,MAAM,CAACU,iBAAX,EAA8B;AAC5BC,MAAAA,aAAa,CAACX,MAAM,CAACU,iBAAR,CAAb;AACD;;AACDV,IAAAA,MAAM,CAACU,iBAAP,GAA2BE,WAAW,CAAC,YAAM;AAC3CtB,MAAAA,KAAK,CAACuB,QAAN,CAAejB,YAAf;AACD,KAFqC,EAEnC,OAAO,EAAP,GAAY,EAFuB,CAAtC;AAGA;AACD,GAVD,MAUO;AACL,WAAOI,MAAM,CAACC,KAAP,CAAaC,QAAb,CAAsBC,OAAtB,CAA8BC,MAA9B,CAAqCC,aAA5C;AACD;AACF,CAdD;;AAgBAL,MAAM,CAACc,QAAP,CAAgBC,GAAhB,CAAoB,eAApB,EAAqC,YAAM;AACzCC,EAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ,EADyC,CAGzC;;AACApB,EAAAA,oBAAoB,GAJqB,CAMzC;AACA;AACA;AACA;;AACA,MAAIqB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,aAAzB,IAA0CF,OAAO,CAACC,GAAR,CAAYE,mCAAZ,KAAoD,MAAlG,EAA0G;AACxGrB,IAAAA,MAAM,CAACC,KAAP,CAAaC,QAAb,CAAsBC,OAAtB,CAA8BC,MAA9B,CAAqC,YAArC,qBAA+Dd,KAAK,CAACgB,KAAN,CAAYC,IAAZ,CAAiBC,KAAjB,CAAuBC,GAAtF;AACD,GAZwC,CAczC;;;AACAnB,EAAAA,KAAK,CAACuB,QAAN,CAAetB,uBAAf;AACAD,EAAAA,KAAK,CAACuB,QAAN,CAAelB,4BAAf;AACAL,EAAAA,KAAK,CAACuB,QAAN,CAAerB,2BAAf;AACAF,EAAAA,KAAK,CAACuB,QAAN,CAAepB,2CAAf;AACAH,EAAAA,KAAK,CAACuB,QAAN,CAAenB,gCAAf;AACD,CApBD;AAsBAM,MAAM,CAACc,QAAP,CAAgBC,GAAhB,CAAoB,oBAApB,EAA0C,YAAM;AAC9ClB,EAAAA,oBAAoB;AACrB,CAFD","sourcesContent":["import store from '@/store';\nimport {\n  AUTH_FETCH_CURRENT_USER,\n  PHARMACIES_FETCH_PHARMACIES,\n  DETAILERS_JOB_FETCH_INFORMATIONAL_TRAININGS,\n  DETAILERS_JOB_FETCH_SAVED_STATES,\n  PAGES_FETCH_PAGE_PERMISSIONS,\n  AUTH_REFRESH,\n} from './store/types/action-types';\n\nconst refreshAxiosInstance = () => {\n  if (store.getters.isAuthenticated) {\n    window.axios.defaults.headers.common.Authorization = `Bearer ${store.state.auth.token.raw}`;\n    /* eslint-disable no-underscore-dangle */\n    if (window._tokenAccessTimer) {\n      clearInterval(window._tokenAccessTimer);\n    }\n    window._tokenAccessTimer = setInterval(() => {\n      store.dispatch(AUTH_REFRESH);\n    }, 1000 * 60 * 25);\n    /* eslint-enable no-underscore-dangle */\n  } else {\n    delete window.axios.defaults.headers.common.Authorization;\n  }\n};\n\nwindow.eventBus.$on('authenticated', () => {\n  console.log('User has been authenticated...');\n\n  // Set authorization headers\n  refreshAxiosInstance();\n\n  // In the STAGING environment there is HTTP Basic Auth enabled, which\n  // overwrites the Authorization headers. In order for Wordpress to function\n  // correctly, we need to provide the Auth token in an extra header, which\n  // is then used by Nginx to overwrite the Authorization header with that value.\n  if (process.env.NODE_ENV !== 'development' && process.env.VUE_APP_WITH_X_AUTHORIZATION_HEADER === 'true') {\n    window.axios.defaults.headers.common['X-APO-AUTH'] = `Bearer ${store.state.auth.token.raw}`;\n  }\n\n  // Load state that requires an authenticated user\n  store.dispatch(AUTH_FETCH_CURRENT_USER);\n  store.dispatch(PAGES_FETCH_PAGE_PERMISSIONS);\n  store.dispatch(PHARMACIES_FETCH_PHARMACIES);\n  store.dispatch(DETAILERS_JOB_FETCH_INFORMATIONAL_TRAININGS);\n  store.dispatch(DETAILERS_JOB_FETCH_SAVED_STATES);\n});\n\nwindow.eventBus.$on('recivedAccessToken', () => {\n  refreshAxiosInstance();\n});\n"]}]}